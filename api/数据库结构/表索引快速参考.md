# Dify æ•°æ®åº“è¡¨ç´¢å¼•å¿«é€Ÿå‚è€ƒ

## è¡¨æ€»è§ˆ

æœ¬æ–‡æ¡£æä¾› Dify æ•°æ®åº“ä¸­æ‰€æœ‰ 87 ä¸ªè¡¨çš„å¿«é€Ÿç´¢å¼•ï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»ã€‚

---

## 1. è´¦æˆ·ä¸ç§Ÿæˆ·ç®¡ç† (7 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `accounts` | ç”¨æˆ·è´¦æˆ·ç®¡ç† | id, name, email, status |
| `tenants` | ç§Ÿæˆ·/å·¥ä½œç©ºé—´ç®¡ç† | id, name, plan, status |
| `tenant_account_joins` | ç§Ÿæˆ·ç”¨æˆ·å…³è” | tenant_id, account_id, role |
| `account_integrates` | ç¬¬ä¸‰æ–¹è´¦æˆ·é›†æˆ | account_id, provider, open_id |
| `invitation_codes` | é‚€è¯·ç ç®¡ç† | code, status, batch |
| `account_plugin_permissions` | ç§Ÿæˆ·æ’ä»¶æƒé™ | tenant_id, install_permission |
| `tenant_plugin_auto_upgrade_strategies` | æ’ä»¶è‡ªåŠ¨å‡çº§ç­–ç•¥ | tenant_id, strategy_setting |

---

## 2. åº”ç”¨ç®¡ç† (15 è¡¨)

### æ ¸å¿ƒåº”ç”¨è¡¨
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `apps` | AIåº”ç”¨ä¸»è¡¨ | id, tenant_id, name, mode |
| `app_model_configs` | åº”ç”¨æ¨¡å‹é…ç½® | app_id, provider, model_id |
| `sites` | åº”ç”¨ç«™ç‚¹é…ç½® | app_id, title, code |

### ä¼šè¯ä¸æ¶ˆæ¯
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `conversations` | ä¼šè¯ç®¡ç† | id, app_id, name, status |
| `messages` | æ¶ˆæ¯è®°å½• | id, conversation_id, query, answer |
| `message_agent_thoughts` | AIä»£ç†æ€è€ƒè¿‡ç¨‹ | message_id, thought, tool |
| `message_annotations` | æ¶ˆæ¯æ ‡æ³¨ | message_id, content, account_id |
| `message_chains` | æ¶ˆæ¯é“¾ | id, message_id, type |
| `message_feedbacks` | æ¶ˆæ¯åé¦ˆ | message_id, rating, content |
| `message_files` | æ¶ˆæ¯é™„ä»¶ | message_id, url, type |

### ç³»ç»Ÿä¸ç”¨æˆ·
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `dify_setups` | ç³»ç»Ÿåˆå§‹åŒ– | version, setup_at |
| `end_users` | ç»ˆç«¯ç”¨æˆ· | id, tenant_id, session_id |
| `upload_files` | æ–‡ä»¶ä¸Šä¼  | id, name, size, key |
| `recommended_apps` | æ¨èåº”ç”¨ | app_id, language, category |
| `installed_apps` | å·²å®‰è£…åº”ç”¨ | tenant_id, app_id, is_pinned |

---

## 3. æ•°æ®é›†ç®¡ç† (12 è¡¨)

### æ ¸å¿ƒæ•°æ®é›†è¡¨
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `datasets` | æ•°æ®é›†ä¸»è¡¨ | id, tenant_id, name, indexing_technique |
| `documents` | æ–‡æ¡£ç®¡ç† | id, dataset_id, name, indexing_status |
| `document_segments` | æ–‡æ¡£åˆ†æ®µ | id, document_id, content, tokens |

### æ•°æ®é›†åŠŸèƒ½è¡¨
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `app_dataset_joins` | åº”ç”¨æ•°æ®é›†å…³è” | app_id, dataset_id |
| `dataset_permissions` | æ•°æ®é›†æƒé™ | dataset_id, account_id |
| `dataset_process_rules` | æ•°æ®å¤„ç†è§„åˆ™ | dataset_id, mode, rules |
| `dataset_queries` | æ•°æ®é›†æŸ¥è¯¢è®°å½• | dataset_id, content, source |
| `dataset_keyword_tables` | å…³é”®è¯è¡¨ | dataset_id, keyword_table |
| `dataset_collection_bindings` | é›†åˆç»‘å®š | provider_name, collection_name |

### å‘é‡ä¸å¤–éƒ¨çŸ¥è¯†
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `embeddings` | å‘é‡åµŒå…¥ | hash, embedding |
| `external_knowledge_apis` | å¤–éƒ¨çŸ¥è¯†API | name, settings |
| `external_knowledge_bindings` | å¤–éƒ¨çŸ¥è¯†ç»‘å®š | dataset_id, external_knowledge_id |

---

## 4. å·¥ä½œæµç®¡ç† (4 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `workflows` | å·¥ä½œæµå®šä¹‰ | id, app_id, type, graph |
| `workflow_runs` | å·¥ä½œæµè¿è¡Œå®ä¾‹ | id, workflow_id, status, inputs |
| `workflow_node_executions` | èŠ‚ç‚¹æ‰§è¡Œè®°å½• | workflow_run_id, node_id, status |
| `workflow_app_logs` | å·¥ä½œæµåº”ç”¨æ—¥å¿— | app_id, workflow_id, created_from |
| `conversation_variables` | ä¼šè¯å˜é‡ | app_id, conversation_id, variable |

---

## 5. æ¨¡å‹æä¾›å•†ç®¡ç† (6 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `providers` | æ¨¡å‹æä¾›å•† | id, tenant_id, provider_name, is_valid |
| `provider_models` | æä¾›å•†æ¨¡å‹ | tenant_id, provider_name, model_name |
| `provider_model_settings` | æ¨¡å‹è®¾ç½® | provider_name, model_name, model_type |
| `provider_orders` | æä¾›å•†é¡ºåº | tenant_id, provider_name, sort_order |
| `tenant_default_models` | ç§Ÿæˆ·é»˜è®¤æ¨¡å‹ | tenant_id, model_type, provider_name |
| `tenant_preferred_model_providers` | ç§Ÿæˆ·é¦–é€‰æä¾›å•† | tenant_id, provider_name |
| `load_balancing_model_configs` | è´Ÿè½½å‡è¡¡é…ç½® | tenant_id, provider_name, model_name |

---

## 6. å·¥å…·ç®¡ç† (8 è¡¨)

### å·¥å…·æä¾›å•†
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `tool_api_providers` | APIå·¥å…·æä¾›å•† | id, name, schema, tools_str |
| `tool_builtin_providers` | å†…ç½®å·¥å…·æä¾›å•† | id, tenant_id, provider, encrypted_credentials |
| `tool_workflow_providers` | å·¥ä½œæµå·¥å…·æä¾›å•† | id, app_id, name, parameter_configuration |

### å·¥å…·åŠŸèƒ½è¡¨
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `tool_conversation_variables` | å·¥å…·ä¼šè¯å˜é‡ | conversation_id, variables_str |
| `tool_files` | å·¥å…·æ–‡ä»¶ | id, user_id, tool_file_id |
| `tool_label_bindings` | å·¥å…·æ ‡ç­¾ç»‘å®š | tool_id, tool_type, label_name |
| `tool_model_invokes` | å·¥å…·æ¨¡å‹è°ƒç”¨ | id, user_id, tool_type, model_provider |

### OAuthæ”¯æŒ
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `tool_oauth_system_clients` | ç³»ç»Ÿçº§OAuthå®¢æˆ·ç«¯ | plugin_id, provider |
| `tool_oauth_tenant_clients` | ç§Ÿæˆ·çº§OAuthå®¢æˆ·ç«¯ | tenant_id, plugin_id, provider |

---

## 7. ä»»åŠ¡ç®¡ç† (2 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `celery_taskmeta` | Celeryä»»åŠ¡å…ƒæ•°æ® | task_id, status, result |
| `celery_tasksetmeta` | Celeryä»»åŠ¡é›†å…ƒæ•°æ® | taskset_id, result |

---

## 8. Webç›¸å…³ (2 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `saved_messages` | ä¿å­˜çš„æ¶ˆæ¯ | app_id, message_id, created_by |
| `pinned_conversations` | ç½®é¡¶ä¼šè¯ | app_id, conversation_id, created_by |

---

## 9. æ•°æ®æºç®¡ç† (2 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `data_source_oauth_bindings` | OAuthæ•°æ®æºç»‘å®š | tenant_id, provider, access_token |
| `data_source_api_key_auth_bindings` | APIå¯†é’¥æ•°æ®æºç»‘å®š | tenant_id, provider, credentials |

---

## 10. æ‰©å±•ç®¡ç† (1 è¡¨)

| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `api_based_extensions` | APIæ‰©å±• | tenant_id, name, api_endpoint |

---

## 11. å…¶ä»–æ”¯æŒè¡¨ (28 è¡¨)

### APIä¸è®¤è¯
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `api_requests` | APIè¯·æ±‚æ—¥å¿— | tenant_id, path, ip |
| `api_tokens` | APIä»¤ç‰Œ | app_id, token, type |

### æ ‡ç­¾ç³»ç»Ÿ
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `tags` | æ ‡ç­¾ç®¡ç† | tenant_id, type, name |
| `tag_bindings` | æ ‡ç­¾ç»‘å®š | tag_id, target_id |

### å…¶ä»–åŠŸèƒ½è¡¨
| è¡¨å | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|
| `operation_logs` | æ“ä½œæ—¥å¿— | tenant_id, account_id, action |
| `trace_app_configs` | åº”ç”¨è¿½è¸ªé…ç½® | app_id, tracing_provider |
| `dataset_retriever_resources` | æ•°æ®é›†æ£€ç´¢èµ„æº | message_id, position, dataset_id |
| `app_annotation_settings` | åº”ç”¨æ ‡æ³¨è®¾ç½® | app_id, score_threshold |
| `app_annotation_hit_histories` | æ ‡æ³¨å‘½ä¸­å†å² | app_id, annotation_id, source |
| `tidb_auth_bindings` | TiDBè®¤è¯ç»‘å®š | user_id, api_url, cluster_id |
| `whitelists` | ç™½åå• | tenant_id, target_id, target_type |

---

## ç´¢å¼•ç»Ÿè®¡

### æŒ‰è¡¨æ•°é‡åˆ†ç»„
- **10+ å­—æ®µè¡¨**: 15 ä¸ª (å¤æ‚ä¸šåŠ¡è¡¨)
- **5-10 å­—æ®µè¡¨**: 42 ä¸ª (æ ‡å‡†ä¸šåŠ¡è¡¨)  
- **<5 å­—æ®µè¡¨**: 30 ä¸ª (å…³è”è¡¨å’Œç®€å•è¡¨)

### æŒ‰åŠŸèƒ½é‡è¦æ€§
- **ğŸ”´ æ ¸å¿ƒè¡¨ (18ä¸ª)**: åº”ç”¨ã€ä¼šè¯ã€æ¶ˆæ¯ã€æ•°æ®é›†ã€å·¥ä½œæµç­‰
- **ğŸŸ¡ é‡è¦è¡¨ (35ä¸ª)**: ç”¨æˆ·ç®¡ç†ã€å·¥å…·ã€æä¾›å•†ç­‰
- **ğŸŸ¢ è¾…åŠ©è¡¨ (34ä¸ª)**: æ—¥å¿—ã€é…ç½®ã€å…³è”è¡¨ç­‰

### å¸¸ç”¨æŸ¥è¯¢æ¨¡å¼
- **ç§Ÿæˆ·éš”ç¦»**: WHERE tenant_id = ?
- **åº”ç”¨èŒƒå›´**: WHERE app_id = ?  
- **æ—¶é—´èŒƒå›´**: WHERE created_at BETWEEN ? AND ?
- **çŠ¶æ€è¿‡æ»¤**: WHERE status = 'active'
- **è½¯åˆ é™¤**: WHERE enabled = true AND archived = false

---

**è¯´æ˜**: æœ¬æ–‡æ¡£æä¾›å¿«é€ŸæŸ¥æ‰¾è¡¨æ ¼çš„ç´¢å¼•ï¼Œè¯¦ç»†çš„å­—æ®µå®šä¹‰è¯·å‚è€ƒ [æ•°æ®åº“è¡¨ç»“æ„åŠå…³ç³».md](./æ•°æ®åº“è¡¨ç»“æ„åŠå…³ç³».md)ã€‚