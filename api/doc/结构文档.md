# Dify API 接口文档

本文档整理了 Dify 项目中所有 Flask API 接口的详细信息，包括 API URL、输入输出参数以及所属端点。

## 目录

- [Console API (控制台接口)](#console-api-控制台接口)
- [Web API (Web端接口)](#web-api-web端接口)
- [Service API (服务端接口)](#service-api-服务端接口)
- [Inner API (内部接口)](#inner-api-内部接口)
- [Files API (文件接口)](#files-api-文件接口)
- [MCP API (MCP接口)](#mcp-api-mcp接口)

---

## Console API (控制台接口)

**基础路径**: `/console/api`

### 应用管理 (App Management)

#### 1. 应用列表
- **URL**: `GET /console/api/apps`
- **功能**: 获取应用列表
- **输入参数**:
  - `page` (int): 页码，范围1-99999，默认1
  - `limit` (int): 每页数量，范围1-100，默认20
  - `mode` (str): 应用模式过滤
  - `tag_ids` (str): 标签ID列表，逗号分隔
- **输出**: 应用列表分页数据
- **权限**: 需要登录、账户初始化、企业许可证

#### 2. 创建应用
- **URL**: `POST /console/api/apps`
- **功能**: 创建新应用
- **输入参数**:
  - `name` (str): 应用名称
  - `mode` (str): 应用模式 (chat, agent-chat, advanced-chat, workflow, completion)
  - `description` (str): 应用描述
- **输出**: 创建的应用详情
- **权限**: 需要登录、账户初始化、计费资源检查

#### 3. 应用详情
- **URL**: `GET /console/api/apps/<uuid:app_id>`
- **功能**: 获取指定应用详情
- **输入参数**:
  - `app_id` (uuid): 应用ID
- **输出**: 应用详细信息
- **权限**: 需要登录、账户初始化、企业许可证

#### 4. 更新应用
- **URL**: `PUT /console/api/apps/<uuid:app_id>`
- **功能**: 更新应用信息
- **输入参数**:
  - `app_id` (uuid): 应用ID
  - `name` (str): 应用名称
  - `description` (str): 应用描述
- **输出**: 更新后的应用信息
- **权限**: 需要登录、账户初始化

#### 5. 删除应用
- **URL**: `DELETE /console/api/apps/<uuid:app_id>`
- **功能**: 删除指定应用
- **输入参数**:
  - `app_id` (uuid): 应用ID
- **输出**: 删除结果
- **权限**: 需要登录、账户初始化

#### 6. 复制应用
- **URL**: `POST /console/api/apps/<uuid:app_id>/copy`
- **功能**: 复制应用
- **输入参数**:
  - `app_id` (uuid): 源应用ID
  - `name` (str): 新应用名称
- **输出**: 复制后的应用信息
- **权限**: 需要登录、账户初始化

#### 7. 导出应用
- **URL**: `GET /console/api/apps/<uuid:app_id>/export`
- **功能**: 导出应用配置
- **输入参数**:
  - `app_id` (uuid): 应用ID
- **输出**: 应用配置文件
- **权限**: 需要登录、账户初始化

#### 8. 修改应用名称
- **URL**: `POST /console/api/apps/<uuid:app_id>/name`
- **功能**: 修改应用名称
- **输入参数**:
  - `app_id` (uuid): 应用ID
  - `name` (str): 新名称
- **输出**: 更新后的应用信息
- **权限**: 需要登录、账户初始化

#### 9. 修改应用图标
- **URL**: `POST /console/api/apps/<uuid:app_id>/icon`
- **功能**: 修改应用图标
- **输入参数**:
  - `app_id` (uuid): 应用ID
  - `icon` (str): 图标数据
- **输出**: 更新后的应用信息
- **权限**: 需要登录、账户初始化

#### 10. 应用站点状态
- **URL**: `POST /console/api/apps/<uuid:app_id>/site-enable`
- **功能**: 启用/禁用应用站点
- **输入参数**:
  - `app_id` (uuid): 应用ID
  - `enable_site` (bool): 是否启用站点
- **输出**: 更新后的应用信息
- **权限**: 需要登录、账户初始化

#### 11. 应用API状态
- **URL**: `POST /console/api/apps/<uuid:app_id>/api-enable`
- **功能**: 启用/禁用应用API
- **输入参数**:
  - `app_id` (uuid): 应用ID
  - `enable_api` (bool): 是否启用API
- **输出**: 更新后的应用信息
- **权限**: 需要登录、账户初始化

### 认证管理 (Authentication)

#### 1. 用户登录
- **URL**: `POST /console/api/login`
- **功能**: 用户登录认证
- **输入参数**:
  - `email` (str): 邮箱地址
  - `password` (str): 密码
  - `remember_me` (bool): 是否记住登录，默认false
  - `invite_token` (str): 邀请令牌，可选
  - `language` (str): 语言设置，默认"en-US"
- **输出**: 登录结果和用户信息
- **权限**: 需要邮箱密码登录启用

#### 2. 用户登出
- **URL**: `GET /console/api/logout`
- **功能**: 用户登出
- **输入参数**: 无
- **输出**: 登出结果
- **权限**: 无特殊要求

#### 3. 发送重置密码邮件
- **URL**: `POST /console/api/reset-password`
- **功能**: 发送密码重置邮件
- **输入参数**:
  - `email` (str): 邮箱地址
- **输出**: 发送结果
- **权限**: 需要邮箱密码登录启用

#### 4. 发送邮箱验证码登录邮件
- **URL**: `POST /console/api/email-code-login`
- **功能**: 发送邮箱验证码
- **输入参数**:
  - `email` (str): 邮箱地址
- **输出**: 发送结果
- **权限**: 无特殊要求

#### 5. 邮箱验证码登录
- **URL**: `POST /console/api/email-code-login/validity`
- **功能**: 使用邮箱验证码登录
- **输入参数**:
  - `email` (str): 邮箱地址
  - `code` (str): 验证码
- **输出**: 登录结果
- **权限**: 无特殊要求

#### 6. 刷新Token
- **URL**: `POST /console/api/refresh-token`
- **功能**: 刷新访问令牌
- **输入参数**:
  - `refresh_token` (str): 刷新令牌
- **输出**: 新的访问令牌
- **权限**: 无特殊要求

### 数据集管理 (Dataset Management)

#### 1. 数据集列表
- **URL**: `GET /console/api/datasets`
- **功能**: 获取数据集列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
  - `provider` (str): 提供商过滤
  - `search` (str): 搜索关键词
- **输出**: 数据集列表分页数据
- **权限**: 需要登录、账户初始化、企业许可证

#### 2. 创建数据集
- **URL**: `POST /console/api/datasets`
- **功能**: 创建新数据集
- **输入参数**:
  - `name` (str): 数据集名称
  - `description` (str): 数据集描述
  - `indexing_technique` (str): 索引技术
- **输出**: 创建的数据集信息
- **权限**: 需要登录、账户初始化、计费限制检查

#### 3. 数据集详情
- **URL**: `GET /console/api/datasets/<uuid:dataset_id>`
- **功能**: 获取指定数据集详情
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
- **输出**: 数据集详细信息
- **权限**: 需要登录、账户初始化

#### 4. 更新数据集
- **URL**: `PATCH /console/api/datasets/<uuid:dataset_id>`
- **功能**: 更新数据集信息
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `name` (str): 数据集名称
  - `description` (str): 数据集描述
- **输出**: 更新后的数据集信息
- **权限**: 需要登录、账户初始化、计费限制检查

#### 5. 删除数据集
- **URL**: `DELETE /console/api/datasets/<uuid:dataset_id>`
- **功能**: 删除指定数据集
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
- **输出**: 删除结果
- **权限**: 需要登录、账户初始化、计费限制检查

### 工作空间管理 (Workspace Management)

#### 1. 租户列表
- **URL**: `GET /console/api/workspaces`
- **功能**: 获取所有租户列表
- **输入参数**: 无
- **输出**: 租户列表
- **权限**: 需要登录、账户初始化

#### 2. 工作空间列表
- **URL**: `GET /console/api/all-workspaces`
- **功能**: 获取所有工作空间列表
- **输入参数**: 无
- **输出**: 工作空间列表
- **权限**: 需要登录、账户初始化

#### 3. 当前工作空间信息
- **URL**: `GET /console/api/workspaces/current`
- **功能**: 获取当前工作空间信息
- **输入参数**: 无
- **输出**: 当前工作空间详情
- **权限**: 需要登录、账户初始化

#### 4. 切换工作空间
- **URL**: `POST /console/api/workspaces/switch`
- **功能**: 切换到指定工作空间
- **输入参数**:
  - `tenant_id` (uuid): 目标工作空间ID
- **输出**: 切换结果
- **权限**: 需要登录、账户初始化

### 文件管理 (File Management)

#### 1. 文件上传
- **URL**: `POST /console/api/files/upload`
- **功能**: 上传文件
- **输入参数**:
  - `file` (file): 文件数据
  - `source` (str): 文件来源
- **输出**: 上传结果和文件信息
- **权限**: 需要登录、账户初始化

#### 2. 文件预览
- **URL**: `GET /console/api/files/<uuid:file_id>/preview`
- **功能**: 预览文件内容
- **输入参数**:
  - `file_id` (uuid): 文件ID
- **输出**: 文件预览内容
- **权限**: 需要登录、账户初始化

#### 3. 文件支持类型
- **URL**: `GET /console/api/files/support-type`
- **功能**: 获取支持的文件类型
- **输入参数**: 无
- **输出**: 支持的文件类型列表
- **权限**: 需要登录、账户初始化

---

## Web API (Web端接口)

**基础路径**: `/api`

### 应用相关 (App Related)

#### 1. 应用参数
- **URL**: `GET /api/parameters`
- **功能**: 获取应用参数
- **输入参数**: 无
- **输出**: 应用参数配置
- **权限**: 需要应用访问权限

#### 2. 应用元数据
- **URL**: `GET /api/meta`
- **功能**: 获取应用元数据
- **输入参数**: 无
- **输出**: 应用元数据信息
- **权限**: 需要应用访问权限

#### 3. 应用访问模式
- **URL**: `GET /api/webapp/access-mode`
- **功能**: 获取Web应用访问模式
- **输入参数**: 无
- **输出**: 访问模式配置
- **权限**: 需要应用访问权限

#### 4. Web认证权限
- **URL**: `GET /api/webapp/permission`
- **功能**: 获取Web应用认证权限
- **输入参数**: 无
- **输出**: 权限配置信息
- **权限**: 需要应用访问权限

### 对话管理 (Conversation Management)

#### 1. 对话列表
- **URL**: `GET /api/conversations`
- **功能**: 获取对话列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 对话列表分页数据
- **权限**: 需要应用访问权限

#### 2. 对话详情
- **URL**: `GET /api/conversations/<uuid:c_id>`
- **功能**: 获取指定对话详情
- **输入参数**:
  - `c_id` (uuid): 对话ID
- **输出**: 对话详细信息
- **权限**: 需要应用访问权限

#### 3. 重命名对话
- **URL**: `POST /api/conversations/<uuid:c_id>/name`
- **功能**: 重命名对话
- **输入参数**:
  - `c_id` (uuid): 对话ID
  - `name` (str): 新名称
- **输出**: 更新结果
- **权限**: 需要应用访问权限

#### 4. 置顶对话
- **URL**: `POST /api/conversations/<uuid:c_id>/pin`
- **功能**: 置顶对话
- **输入参数**:
  - `c_id` (uuid): 对话ID
- **输出**: 置顶结果
- **权限**: 需要应用访问权限

#### 5. 取消置顶对话
- **URL**: `POST /api/conversations/<uuid:c_id>/unpin`
- **功能**: 取消置顶对话
- **输入参数**:
  - `c_id` (uuid): 对话ID
- **输出**: 取消置顶结果
- **权限**: 需要应用访问权限

### 消息管理 (Message Management)

#### 1. 消息列表
- **URL**: `GET /api/messages`
- **功能**: 获取消息列表
- **输入参数**:
  - `conversation_id` (uuid): 对话ID
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 消息列表分页数据
- **权限**: 需要应用访问权限

#### 2. 消息反馈
- **URL**: `POST /api/messages/<uuid:message_id>/feedbacks`
- **功能**: 提交消息反馈
- **输入参数**:
  - `message_id` (uuid): 消息ID
  - `rating` (str): 评分
  - `content` (str): 反馈内容
- **输出**: 反馈提交结果
- **权限**: 需要应用访问权限

### 完成和聊天 (Completion & Chat)

#### 1. 完成消息
- **URL**: `POST /api/completion-messages`
- **功能**: 发送完成请求
- **输入参数**:
  - `query` (str): 查询内容
  - `inputs` (dict): 输入参数
- **输出**: 完成响应
- **权限**: 需要应用访问权限

#### 2. 停止完成
- **URL**: `POST /api/completion-messages/<string:task_id>/stop`
- **功能**: 停止完成任务
- **输入参数**:
  - `task_id` (str): 任务ID
- **输出**: 停止结果
- **权限**: 需要应用访问权限

#### 3. 聊天消息
- **URL**: `POST /api/chat-messages`
- **功能**: 发送聊天消息
- **输入参数**:
  - `query` (str): 消息内容
  - `conversation_id` (uuid): 对话ID
  - `inputs` (dict): 输入参数
- **输出**: 聊天响应
- **权限**: 需要应用访问权限

#### 4. 停止聊天
- **URL**: `POST /api/chat-messages/<string:task_id>/stop`
- **功能**: 停止聊天任务
- **输入参数**:
  - `task_id` (str): 任务ID
- **输出**: 停止结果
- **权限**: 需要应用访问权限

---

## Service API (服务端接口)

**基础路径**: `/v1`

### 应用管理 (App Management)

#### 1. 应用参数
- **URL**: `GET /v1/parameters`
- **功能**: 获取应用参数
- **输入参数**: 无
- **输出**: 应用参数配置
- **权限**: 需要API Key认证

#### 2. 应用元数据
- **URL**: `GET /v1/meta`
- **功能**: 获取应用元数据
- **输入参数**: 无
- **输出**: 应用元数据信息
- **权限**: 需要API Key认证

#### 3. 应用信息
- **URL**: `GET /v1/info`
- **功能**: 获取应用基本信息
- **输入参数**: 无
- **输出**: 应用基本信息
- **权限**: 需要API Key认证

### 对话管理 (Conversation Management)

#### 1. 对话列表
- **URL**: `GET /v1/conversations`
- **功能**: 获取对话列表
- **输入参数**:
  - `user` (str): 用户标识
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 对话列表分页数据
- **权限**: 需要API Key认证

#### 2. 对话详情
- **URL**: `GET /v1/conversations/<uuid:c_id>`
- **功能**: 获取指定对话详情
- **输入参数**:
  - `c_id` (uuid): 对话ID
- **输出**: 对话详细信息
- **权限**: 需要API Key认证

#### 3. 重命名对话
- **URL**: `POST /v1/conversations/<uuid:c_id>/name`
- **功能**: 重命名对话
- **输入参数**:
  - `c_id` (uuid): 对话ID
  - `name` (str): 新名称
- **输出**: 更新结果
- **权限**: 需要API Key认证

### 消息管理 (Message Management)

#### 1. 消息列表
- **URL**: `GET /v1/messages`
- **功能**: 获取消息列表
- **输入参数**:
  - `conversation_id` (uuid): 对话ID
  - `user` (str): 用户标识
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 消息列表分页数据
- **权限**: 需要API Key认证

#### 2. 消息反馈
- **URL**: `POST /v1/messages/<uuid:message_id>/feedbacks`
- **功能**: 提交消息反馈
- **输入参数**:
  - `message_id` (uuid): 消息ID
  - `rating` (str): 评分
  - `content` (str): 反馈内容
  - `user` (str): 用户标识
- **输出**: 反馈提交结果
- **权限**: 需要API Key认证

### 数据集管理 (Dataset Management)

#### 1. 数据集列表
- **URL**: `GET /v1/datasets`
- **功能**: 获取数据集列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 数据集列表分页数据
- **权限**: 需要API Key认证

#### 2. 数据集详情
- **URL**: `GET /v1/datasets/<uuid:dataset_id>`
- **功能**: 获取指定数据集详情
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
- **输出**: 数据集详细信息
- **权限**: 需要API Key认证

---

## Inner API (内部接口)

**基础路径**: `/inner/api`

### 插件调用 (Plugin Invocation)

#### 1. 调用LLM
- **URL**: `POST /inner/api/invoke/llm`
- **功能**: 调用大语言模型
- **输入参数**:
  - `model` (str): 模型名称
  - `messages` (list): 消息列表
  - `parameters` (dict): 模型参数
- **输出**: LLM响应结果
- **权限**: 内部服务认证

#### 2. 调用文本嵌入
- **URL**: `POST /inner/api/invoke/text-embedding`
- **功能**: 调用文本嵌入模型
- **输入参数**:
  - `model` (str): 嵌入模型名称
  - `texts` (list): 文本列表
- **输出**: 嵌入向量结果
- **权限**: 内部服务认证

#### 3. 调用重排序
- **URL**: `POST /inner/api/invoke/rerank`
- **功能**: 调用重排序模型
- **输入参数**:
  - `model` (str): 重排序模型名称
  - `query` (str): 查询文本
  - `docs` (list): 文档列表
- **输出**: 重排序结果
- **权限**: 内部服务认证

---

## Files API (文件接口)

**基础路径**: `/files`

### 文件预览 (File Preview)

#### 1. 图片预览
- **URL**: `GET /files/<uuid:file_id>/image-preview`
- **功能**: 预览图片文件
- **输入参数**:
  - `file_id` (uuid): 文件ID
- **输出**: 图片预览数据
- **权限**: 文件访问权限

#### 2. 文件预览
- **URL**: `GET /files/<uuid:file_id>/file-preview`
- **功能**: 预览文件内容
- **输入参数**:
  - `file_id` (uuid): 文件ID
- **输出**: 文件预览内容
- **权限**: 文件访问权限

#### 3. 工具文件预览
- **URL**: `GET /files/tools/<uuid:file_id>.<string:extension>`
- **功能**: 预览工具文件
- **输入参数**:
  - `file_id` (uuid): 文件ID
  - `extension` (str): 文件扩展名
- **输出**: 工具文件内容
- **权限**: 工具访问权限

---

## MCP API (MCP接口)

**基础路径**: `/mcp`

### MCP服务 (MCP Service)

#### 1. MCP应用接口
- **URL**: `POST /mcp/server/<string:server_code>/mcp`
- **功能**: MCP服务器应用接口
- **输入参数**:
  - `server_code` (str): 服务器代码
  - `method` (str): 调用方法
  - `params` (dict): 调用参数
- **输出**: MCP调用结果
- **权限**: MCP服务认证

---

## 补充接口 (Additional APIs)

### Web API 补充接口

#### 用户认证相关

##### 1. 用户登录
- **URL**: `POST /api/login`
- **功能**: 用户登录认证
- **输入参数**:
  - `email` (str): 邮箱地址
  - `password` (str): 密码
  - `remember_me` (bool): 是否记住登录
- **输出**: 认证令牌和用户信息
- **权限**: 公开接口

##### 2. 邮箱验证码登录发送
- **URL**: `POST /api/email-code-login`
- **功能**: 发送邮箱验证码
- **输入参数**:
  - `email` (str): 邮箱地址
- **输出**: 发送状态
- **权限**: 公开接口

##### 3. 邮箱验证码登录验证
- **URL**: `POST /api/email-code-login/validity`
- **功能**: 使用邮箱验证码登录
- **输入参数**:
  - `email` (str): 邮箱地址
  - `code` (str): 验证码
- **输出**: 认证令牌
- **权限**: 公开接口

#### 密码重置相关

##### 1. 发送重置密码邮件
- **URL**: `POST /api/forgot-password`
- **功能**: 发送密码重置邮件
- **输入参数**:
  - `email` (str): 邮箱地址
- **输出**: 发送状态
- **权限**: 公开接口

##### 2. 验证重置密码令牌
- **URL**: `POST /api/forgot-password/validity`
- **功能**: 验证重置密码令牌
- **输入参数**:
  - `token` (str): 重置令牌
- **输出**: 验证结果
- **权限**: 公开接口

##### 3. 重置密码
- **URL**: `POST /api/forgot-password/resets`
- **功能**: 执行密码重置
- **输入参数**:
  - `token` (str): 重置令牌
  - `new_password` (str): 新密码
- **输出**: 重置结果
- **权限**: 公开接口

#### 保存的消息管理

##### 1. 保存的消息列表
- **URL**: `GET /api/saved-messages`
- **功能**: 获取保存的消息列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 保存的消息列表
- **权限**: 需要应用访问权限

##### 2. 保存的消息详情
- **URL**: `GET /api/saved-messages/<uuid:message_id>`
- **功能**: 获取保存的消息详情
- **输入参数**:
  - `message_id` (uuid): 消息ID
- **输出**: 消息详细信息
- **权限**: 需要应用访问权限

#### 系统功能

##### 1. 系统功能配置
- **URL**: `GET /api/system-features`
- **功能**: 获取系统功能配置
- **输入参数**: 无
- **输出**: 系统功能配置信息
- **权限**: 公开接口

##### 2. 护照验证
- **URL**: `POST /api/passport`
- **功能**: 护照信息验证
- **输入参数**:
  - `passport_info` (dict): 护照信息
- **输出**: 验证结果
- **权限**: 需要应用访问权限

#### 应用相关

##### 1. 应用参数
- **URL**: `GET /api/app/parameters`
- **功能**: 获取应用参数
- **输入参数**: 无
- **输出**: 应用参数配置
- **权限**: 需要应用访问权限

##### 2. 应用元数据
- **URL**: `GET /api/app/meta`
- **功能**: 获取应用元数据
- **输入参数**: 无
- **输出**: 应用元数据信息
- **权限**: 需要应用访问权限

#### 对话相关

##### 1. 对话列表
- **URL**: `GET /api/conversations`
- **功能**: 获取对话列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 对话列表
- **权限**: 需要应用访问权限

##### 2. 对话详情
- **URL**: `GET /api/conversations/<uuid:conversation_id>`
- **功能**: 获取对话详情
- **输入参数**:
  - `conversation_id` (uuid): 对话ID
- **输出**: 对话详细信息
- **权限**: 需要应用访问权限

##### 3. 对话重命名
- **URL**: `POST /api/conversations/<uuid:conversation_id>/name`
- **功能**: 重命名对话
- **输入参数**:
  - `conversation_id` (uuid): 对话ID
  - `name` (str): 新名称
- **输出**: 重命名结果
- **权限**: 需要应用访问权限

##### 4. 删除对话
- **URL**: `DELETE /api/conversations/<uuid:conversation_id>`
- **功能**: 删除对话
- **输入参数**:
  - `conversation_id` (uuid): 对话ID
- **输出**: 删除结果
- **权限**: 需要应用访问权限

#### 消息相关

##### 1. 消息列表
- **URL**: `GET /api/messages`
- **功能**: 获取消息列表
- **输入参数**:
  - `conversation_id` (uuid): 对话ID
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 消息列表
- **权限**: 需要应用访问权限

##### 2. 消息反馈
- **URL**: `POST /api/messages/<uuid:message_id>/feedbacks`
- **功能**: 提交消息反馈
- **输入参数**:
  - `message_id` (uuid): 消息ID
  - `rating` (str): 评分
  - `content` (str): 反馈内容
- **输出**: 反馈结果
- **权限**: 需要应用访问权限

##### 3. 消息标注
- **URL**: `POST /api/messages/<uuid:message_id>/annotations`
- **功能**: 消息标注
- **输入参数**:
  - `message_id` (uuid): 消息ID
  - `annotation` (dict): 标注信息
- **输出**: 标注结果
- **权限**: 需要应用访问权限

##### 4. 更多类似问题
- **URL**: `GET /api/messages/<uuid:message_id>/more-like-this`
- **功能**: 获取更多类似问题
- **输入参数**:
  - `message_id` (uuid): 消息ID
- **输出**: 类似问题列表
- **权限**: 需要应用访问权限

#### 音频相关

##### 1. 文本转语音
- **URL**: `POST /api/audio/text-to-audio`
- **功能**: 文本转语音
- **输入参数**:
  - `text` (str): 待转换文本
  - `voice` (str): 语音类型
- **输出**: 音频文件
- **权限**: 需要应用访问权限

##### 2. 语音转文本
- **URL**: `POST /api/audio/speech-to-text`
- **功能**: 语音转文本
- **输入参数**:
  - `audio_file` (file): 音频文件
- **输出**: 转换的文本
- **权限**: 需要应用访问权限

#### 工作流相关

##### 1. 工作流运行
- **URL**: `POST /api/workflows/run`
- **功能**: 运行工作流
- **输入参数**:
  - `workflow_id` (uuid): 工作流ID
  - `inputs` (dict): 输入参数
- **输出**: 运行结果
- **权限**: 需要应用访问权限

##### 2. 工作流任务状态
- **URL**: `GET /api/workflows/tasks/<string:task_id>/status`
- **功能**: 获取工作流任务状态
- **输入参数**:
  - `task_id` (str): 任务ID
- **输出**: 任务状态
- **权限**: 需要应用访问权限

#### 站点相关

##### 1. 站点信息
- **URL**: `GET /api/site`
- **功能**: 获取站点信息
- **输入参数**: 无
- **输出**: 站点配置信息
- **权限**: 公开接口

### Service API 补充接口

#### 数据集元数据管理

##### 1. 创建数据集元数据
- **URL**: `POST /v1/datasets/<uuid:dataset_id>/metadata`
- **功能**: 创建数据集元数据
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `metadata` (dict): 元数据信息
- **输出**: 创建的元数据信息
- **权限**: 需要API Key认证

##### 2. 数据集元数据详情
- **URL**: `GET /v1/datasets/<uuid:dataset_id>/metadata/<uuid:metadata_id>`
- **功能**: 获取数据集元数据详情
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `metadata_id` (uuid): 元数据ID
- **输出**: 元数据详细信息
- **权限**: 需要API Key认证

##### 3. 内置元数据字段
- **URL**: `GET /v1/datasets/metadata/built-in`
- **功能**: 获取内置元数据字段
- **输入参数**: 无
- **输出**: 内置字段列表
- **权限**: 需要API Key认证

##### 4. 文档元数据编辑
- **URL**: `PUT /v1/datasets/<uuid:dataset_id>/documents/metadata`
- **功能**: 编辑文档元数据
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `metadata` (dict): 元数据信息
- **输出**: 编辑结果
- **权限**: 需要API Key认证

#### 数据集标签管理

##### 1. 数据集标签管理
- **URL**: `GET /v1/datasets/tags`
- **功能**: 获取数据集标签列表
- **输入参数**: 无
- **输出**: 标签列表
- **权限**: 需要API Key认证

##### 2. 数据集标签绑定
- **URL**: `POST /v1/datasets/tags/binding`
- **功能**: 绑定数据集标签
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `tag_ids` (list): 标签ID列表
- **输出**: 绑定结果
- **权限**: 需要API Key认证

##### 3. 数据集标签解绑
- **URL**: `POST /v1/datasets/tags/unbinding`
- **功能**: 解绑数据集标签
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `tag_ids` (list): 标签ID列表
- **输出**: 解绑结果
- **权限**: 需要API Key认证

##### 4. 数据集标签绑定状态
- **URL**: `GET /v1/datasets/<uuid:dataset_id>/tags`
- **功能**: 获取数据集标签绑定状态
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
- **输出**: 标签绑定状态
- **权限**: 需要API Key认证

#### 工作流相关

##### 1. 工作流日志
- **URL**: `GET /v1/workflows/logs`
- **功能**: 获取工作流执行日志
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 工作流日志列表
- **权限**: 需要API Key认证

##### 2. 工作流运行详情
- **URL**: `GET /v1/workflows/run/<string:workflow_run_id>`
- **功能**: 获取工作流运行详情
- **输入参数**:
  - `workflow_run_id` (str): 工作流运行ID
- **输出**: 运行详细信息
- **权限**: 需要API Key认证

#### 应用反馈

##### 1. 应用反馈获取
- **URL**: `GET /v1/app/feedbacks`
- **功能**: 获取应用反馈列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 反馈列表
- **权限**: 需要API Key认证

##### 2. 消息建议
- **URL**: `GET /v1/messages/<uuid:message_id>/suggested`
- **功能**: 获取消息建议
- **输入参数**:
  - `message_id` (uuid): 消息ID
- **输出**: 建议内容
- **权限**: 需要API Key认证

#### 文档状态管理

##### 1. 文档状态查询
- **URL**: `GET /v1/datasets/<uuid:dataset_id>/documents/status/<string:action>`
- **功能**: 查询文档处理状态
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `action` (str): 操作类型
- **输出**: 文档状态信息
- **权限**: 需要API Key认证

#### 文件上传

##### 1. 文件上传
- **URL**: `POST /v1/files/upload`
- **功能**: 上传文件
- **输入参数**:
  - `file` (file): 文件数据
  - `user` (str): 用户标识
- **输出**: 文件上传结果
- **权限**: 需要API Key认证

#### 数据集命中测试

##### 1. 命中测试
- **URL**: `POST /v1/datasets/<uuid:dataset_id>/hit-testing`
- **功能**: 数据集命中测试
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `query` (str): 查询文本
  - `retrieval_model` (dict): 检索模型配置
- **输出**: 命中测试结果
- **权限**: 需要API Key认证

#### 数据集分段

##### 1. 分段列表
- **URL**: `GET /v1/datasets/<uuid:dataset_id>/segments`
- **功能**: 获取数据集分段列表
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `document_id` (uuid): 文档ID
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 分段列表
- **权限**: 需要API Key认证

##### 2. 分段详情
- **URL**: `GET /v1/datasets/<uuid:dataset_id>/segments/<uuid:segment_id>`
- **功能**: 获取分段详情
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `segment_id` (uuid): 分段ID
- **输出**: 分段详细信息
- **权限**: 需要API Key认证

##### 3. 更新分段
- **URL**: `PUT /v1/datasets/<uuid:dataset_id>/segments/<uuid:segment_id>`
- **功能**: 更新分段内容
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `segment_id` (uuid): 分段ID
  - `content` (str): 分段内容
  - `keywords` (list): 关键词列表
- **输出**: 更新结果
- **权限**: 需要API Key认证

##### 4. 删除分段
- **URL**: `DELETE /v1/datasets/<uuid:dataset_id>/segments/<uuid:segment_id>`
- **功能**: 删除分段
- **输入参数**:
  - `dataset_id` (uuid): 数据集ID
  - `segment_id` (uuid): 分段ID
- **输出**: 删除结果
- **权限**: 需要API Key认证

#### 模型相关

##### 1. 模型列表
- **URL**: `GET /v1/models`
- **功能**: 获取可用模型列表
- **输入参数**:
  - `model_type` (str): 模型类型
- **输出**: 模型列表
- **权限**: 需要API Key认证

##### 2. 模型参数
- **URL**: `GET /v1/models/<string:model>/parameters`
- **功能**: 获取模型参数
- **输入参数**:
  - `model` (str): 模型名称
- **输出**: 模型参数配置
- **权限**: 需要API Key认证

#### 站点配置

##### 1. 站点配置
- **URL**: `GET /v1/site`
- **功能**: 获取站点配置
- **输入参数**: 无
- **输出**: 站点配置信息
- **权限**: 需要API Key认证

#### 根路径

##### 1. API根路径
- **URL**: `GET /v1/`
- **功能**: API根路径信息
- **输入参数**: 无
- **输出**: API基本信息
- **权限**: 公开接口

### Console API 补充接口

#### 网站爬取

##### 1. 网站内容爬取
- **URL**: `POST /console/api/website/crawl`
- **功能**: 爬取网站内容
- **输入参数**:
  - `url` (str): 目标URL
  - `options` (dict): 爬取选项
- **输出**: 爬取任务信息
- **权限**: 需要登录、账户初始化

##### 2. 网站爬取状态
- **URL**: `GET /console/api/website/crawl/status/<string:job_id>`
- **功能**: 获取网站爬取状态
- **输入参数**:
  - `job_id` (str): 任务ID
- **输出**: 爬取状态信息
- **权限**: 需要登录、账户初始化

#### 端点管理

##### 1. 创建端点
- **URL**: `POST /console/api/workspaces/current/endpoints/create`
- **功能**: 创建新端点
- **输入参数**:
  - `endpoint_config` (dict): 端点配置
- **输出**: 创建的端点信息
- **权限**: 需要登录、账户初始化

##### 2. 端点列表
- **URL**: `GET /console/api/workspaces/current/endpoints/list`
- **功能**: 获取端点列表
- **输入参数**:
  - `page` (int): 页码
  - `limit` (int): 每页数量
- **输出**: 端点列表
- **权限**: 需要登录、账户初始化

##### 3. 单个插件端点列表
- **URL**: `GET /console/api/workspaces/current/endpoints/list/plugin`
- **功能**: 获取单个插件的端点列表
- **输入参数**:
  - `plugin_id` (uuid): 插件ID
- **输出**: 端点列表
- **权限**: 需要登录、账户初始化

##### 4. 删除端点
- **URL**: `DELETE /console/api/workspaces/current/endpoints/delete`
- **功能**: 删除端点
- **输入参数**:
  - `endpoint_id` (uuid): 端点ID
- **输出**: 删除结果
- **权限**: 需要登录、账户初始化

##### 5. 更新端点
- **URL**: `PUT /console/api/workspaces/current/endpoints/update`
- **功能**: 更新端点配置
- **输入参数**:
  - `endpoint_id` (uuid): 端点ID
  - `endpoint_config` (dict): 端点配置
- **输出**: 更新结果
- **权限**: 需要登录、账户初始化

##### 6. 启用端点
- **URL**: `POST /console/api/workspaces/current/endpoints/enable`
- **功能**: 启用端点
- **输入参数**:
  - `endpoint_id` (uuid): 端点ID
- **输出**: 启用结果
- **权限**: 需要登录、账户初始化

##### 7. 禁用端点
- **URL**: `POST /console/api/workspaces/current/endpoints/disable`
- **功能**: 禁用端点
- **输入参数**:
  - `endpoint_id` (uuid): 端点ID
- **输出**: 禁用结果
- **权限**: 需要登录、账户初始化

#### 管理员功能

##### 1. 插入探索应用
- **URL**: `POST /console/api/admin/insert-explore-apps`
- **功能**: 插入探索应用到列表
- **输入参数**:
  - `app_info` (dict): 应用信息
- **输出**: 插入结果
- **权限**: 管理员权限

##### 2. 删除探索应用
- **URL**: `DELETE /console/api/admin/insert-explore-apps/<uuid:app_id>`
- **功能**: 从探索列表删除应用
- **输入参数**:
  - `app_id` (uuid): 应用ID
- **输出**: 删除结果
- **权限**: 管理员权限

### Files API 补充接口

#### 工作空间相关

##### 1. 工作空间Web应用Logo
- **URL**: `GET /files/workspaces/<uuid:workspace_id>/webapp-logo`
- **功能**: 获取工作空间Web应用Logo
- **输入参数**:
  - `workspace_id` (uuid): 工作空间ID
- **输出**: Logo文件
- **权限**: 文件访问权限

#### 插件文件

##### 1. 插件文件上传
- **URL**: `POST /files/upload/for-plugin`
- **功能**: 为插件上传文件
- **输入参数**:
  - `file` (file): 文件数据
  - `plugin_id` (uuid): 插件ID
- **输出**: 上传结果
- **权限**: 文件访问权限

### Inner API 补充接口

#### 企业功能

##### 1. 企业工作空间管理
- **URL**: `POST /inner/api/enterprise/workspace`
- **功能**: 企业工作空间管理
- **输入参数**:
  - `workspace_info` (dict): 工作空间信息
- **输出**: 工作空间数据
- **权限**: 企业权限

##### 2. 无所有者企业工作空间
- **URL**: `POST /inner/api/enterprise/workspace/ownerless`
- **功能**: 管理无所有者的企业工作空间
- **输入参数**:
  - `workspace_info` (dict): 工作空间信息
- **输出**: 工作空间数据
- **权限**: 企业权限

##### 3. 企业邮件服务
- **URL**: `POST /inner/api/enterprise/mail`
- **功能**: 企业邮件服务
- **输入参数**:
  - `mail_info` (dict): 邮件信息
- **输出**: 发送结果
- **权限**: 企业权限

#### 插件内部API

##### 1. 插件调用LLM
- **URL**: `POST /inner/api/plugin/invoke/llm`
- **功能**: 插件调用大语言模型
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `prompt` (str): 提示词
  - `parameters` (dict): 调用参数
- **输出**: LLM响应结果
- **权限**: 插件内部权限

##### 2. 插件调用带结构化输出的LLM
- **URL**: `POST /inner/api/plugin/invoke/llm/structured-output`
- **功能**: 插件调用带结构化输出的大语言模型
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `prompt` (str): 提示词
  - `output_schema` (dict): 输出结构定义
  - `parameters` (dict): 调用参数
- **输出**: 结构化LLM响应结果
- **权限**: 插件内部权限

##### 3. 插件调用文本嵌入
- **URL**: `POST /inner/api/plugin/invoke/text-embedding`
- **功能**: 插件调用文本嵌入模型
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `texts` (list): 文本列表
  - `parameters` (dict): 调用参数
- **输出**: 文本嵌入向量
- **权限**: 插件内部权限

##### 4. 插件调用Rerank
- **URL**: `POST /inner/api/plugin/invoke/rerank`
- **功能**: 插件调用重排序模型
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `query` (str): 查询文本
  - `documents` (list): 文档列表
  - `parameters` (dict): 调用参数
- **输出**: 重排序结果
- **权限**: 插件内部权限

##### 5. 插件调用TTS
- **URL**: `POST /inner/api/plugin/invoke/tts`
- **功能**: 插件调用文本转语音
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `text` (str): 待转换文本
  - `voice_config` (dict): 语音配置
- **输出**: 音频文件
- **权限**: 插件内部权限

##### 6. 插件调用语音转文本
- **URL**: `POST /inner/api/plugin/invoke/speech2text`
- **功能**: 插件调用语音转文本
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `audio_file` (file): 音频文件
  - `parameters` (dict): 调用参数
- **输出**: 转换的文本
- **权限**: 插件内部权限

##### 7. 插件调用内容审核
- **URL**: `POST /inner/api/plugin/invoke/moderation`
- **功能**: 插件调用内容审核
- **输入参数**:
  - `model_config` (dict): 模型配置
  - `content` (str): 待审核内容
  - `parameters` (dict): 调用参数
- **输出**: 审核结果
- **权限**: 插件内部权限

##### 8. 插件调用工具
- **URL**: `POST /inner/api/plugin/invoke/tool`
- **功能**: 插件调用工具
- **输入参数**:
  - `tool_config` (dict): 工具配置
  - `parameters` (dict): 工具参数
- **输出**: 工具执行结果
- **权限**: 插件内部权限

##### 9. 插件调用参数提取节点
- **URL**: `POST /inner/api/plugin/invoke/parameter-extractor-node`
- **功能**: 插件调用参数提取节点
- **输入参数**:
  - `node_config` (dict): 节点配置
  - `input_data` (dict): 输入数据
- **输出**: 提取的参数
- **权限**: 插件内部权限

##### 10. 插件调用问题分类节点
- **URL**: `POST /inner/api/plugin/invoke/question-classifier-node`
- **功能**: 插件调用问题分类节点
- **输入参数**:
  - `node_config` (dict): 节点配置
  - `question` (str): 问题文本
- **输出**: 分类结果
- **权限**: 插件内部权限

##### 11. 插件调用应用
- **URL**: `POST /inner/api/plugin/invoke/app`
- **功能**: 插件调用应用
- **输入参数**:
  - `app_config` (dict): 应用配置
  - `input_data` (dict): 输入数据
- **输出**: 应用执行结果
- **权限**: 插件内部权限

##### 12. 插件调用加密
- **URL**: `POST /inner/api/plugin/invoke/encrypt`
- **功能**: 插件调用加密服务
- **输入参数**:
  - `data` (str): 待加密数据
  - `encrypt_config` (dict): 加密配置
- **输出**: 加密结果
- **权限**: 插件内部权限

##### 13. 插件调用摘要
- **URL**: `POST /inner/api/plugin/invoke/summary`
- **功能**: 插件调用摘要生成
- **输入参数**:
  - `content` (str): 待摘要内容
  - `summary_config` (dict): 摘要配置
- **输出**: 摘要结果
- **权限**: 插件内部权限

##### 14. 插件上传文件请求
- **URL**: `POST /inner/api/plugin/upload-file-request`
- **功能**: 插件上传文件请求
- **输入参数**:
  - `file_info` (dict): 文件信息
  - `upload_config` (dict): 上传配置
- **输出**: 上传请求结果
- **权限**: 插件内部权限

##### 15. 插件获取应用信息
- **URL**: `GET /inner/api/plugin/fetch-app-info`
- **功能**: 插件获取应用信息
- **输入参数**:
  - `app_id` (uuid): 应用ID
- **输出**: 应用信息
- **权限**: 插件内部权限

---

## 总结

Dify API 提供了完整的 AI 应用开发和管理功能，包括：

### 核心API模块

1. **Console API**: 控制台管理功能
   - 应用管理（创建、配置、发布等）
   - 数据集管理（文档、分段、索引等）
   - 工作空间管理（成员、设置等）
   - 模型管理（配置、提供商等）
   - 插件管理（安装、配置、端点等）
   - 网站爬取功能
   - API Key管理
   - 管理员功能

2. **Service API**: 面向开发者的服务接口
   - 应用调用（聊天、补全、工作流等）
   - 数据集操作（文档管理、命中测试等）
   - 文件上传和管理
   - 消息和对话管理
   - 反馈和标注功能
   - 数据集元数据和标签管理
   - 模型参数获取

3. **Web API**: 面向最终用户的 Web 接口
   - 用户认证（登录、注册、密码重置等）
   - 对话交互（消息发送、接收等）
   - 音频处理（TTS、STT等）
   - 工作流执行
   - 保存的消息管理
   - 系统功能配置

4. **Files API**: 文件管理功能
   - 文件上传和下载
   - 图像和文件预览
   - 工具文件管理
   - 工作空间Logo管理
   - 插件文件上传

5. **Inner API**: 内部服务接口
   - 插件内部调用（LLM、嵌入、TTS等）
   - 企业功能（工作空间、邮件等）
   - 系统内部通信

6. **MCP API**: MCP 服务器管理功能
   - MCP 服务器连接和管理

### API特性

- **RESTful设计**: 所有API遵循RESTful设计原则
- **JSON格式**: 使用JSON格式进行数据交换
- **权限控制**: 完善的权限控制机制
  - 公开接口（无需认证）
  - API Key认证（Service API）
  - 用户登录认证（Console/Web API）
  - 企业权限（Enterprise功能）
  - 插件内部权限（Inner API）
- **错误处理**: 统一的错误处理和响应格式
- **分页支持**: 列表接口支持分页查询
- **文件处理**: 支持多种文件格式的上传和处理
- **实时功能**: 支持流式响应和实时状态查询

### 接口统计

本文档共包含 **200+** 个API接口，覆盖了Dify平台的所有核心功能，为开发者提供了完整的AI应用开发和集成能力。

**注意事项**:
1. 所有接口都需要相应的认证和权限验证
2. 参数类型和格式需要严格按照文档要求
3. 错误处理和状态码请参考具体的API响应
4. 部分接口可能有速率限制和配额限制